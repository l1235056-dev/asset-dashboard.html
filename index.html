<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å…«å¤§å…ƒç´ è³‡ç”¢é…ç½®å„€è¡¨æ¿</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", system-ui, sans-serif;
      background: #f3f4f6;
      color: #111827;
    }
    header {
      background: #111827;
      color: white;
      padding: 16px 20px;
    }
    header h1 {
      margin: 0;
      font-size: 20px;
    }
    header p {
      margin: 4px 0 0;
      font-size: 13px;
      opacity: 0.85;
    }
    main {
      max-width: 1200px;
      margin: 20px auto 40px;
      padding: 0 16px;
    }
    .grid {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 16px;
    }
    @media (max-width: 960px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 16px 18px 18px;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
    }
    .card h2 {
      margin: 0 0 8px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .card h3 {
      margin: 10px 0 6px;
      font-size: 15px;
      border-left: 3px solid #2563eb;
      padding-left: 8px;
    }
    .card p {
      margin: 4px 0;
      font-size: 13px;
      color: #4b5563;
    }
    label {
      display: block;
      font-size: 12px;
      margin-top: 8px;
      margin-bottom: 2px;
      color: #374151;
    }
    input[type="number"],
    input[type="text"] {
      width: 100%;
      padding: 7px 9px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 13px;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    input[type="number"]:focus,
    input[type="text"]:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.25);
    }
    input[type="range"] { width: 100%; }
    .inline-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }
    .third-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
    }
    .small {
      font-size: 11px;
      color: #6b7280;
    }
    button {
      margin-top: 14px;
      width: 100%;
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      background: #2563eb;
      color: white;
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);
      transition: transform 0.05s ease, box-shadow 0.05s ease,
        background 0.1s ease;
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 28px rgba(37, 99, 235, 0.35);
      background: #1d4ed8;
    }
    button:active {
      transform: translateY(0);
      box-shadow: 0 4px 14px rgba(37, 99, 235, 0.3);
    }
    .pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 10px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      font-size: 11px;
      font-weight: 600;
      margin-left: 4px;
    }
    .highlight-box {
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 10px;
      background: #f9fafb;
      border: 1px dashed #d1d5db;
      font-size: 12px;
      color: #374151;
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      margin-top: 4px;
      font-size: 13px;
    }
    .stat-row span.label {
      color: #6b7280;
    }
    .stat-row span.value {
      font-weight: 600;
    }
    .mt-8 { margin-top: 8px; }
    .mt-12 { margin-top: 12px; }
    .mt-4 { margin-top: 4px; }
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      font-size: 11px;
      border-radius: 999px;
      background: #e5e7eb;
      color: #374151;
      font-weight: 600;
      margin-left: 6px;
    }
    .badge.green { background: #dcfce7; color: #166534; }
    .badge.yellow { background: #fef9c3; color: #854d0e; }
    .badge.red { background: #fee2e2; color: #b91c1c; }
    .score {
      font-size: 26px;
      font-weight: 700;
    }
    .score.good { color: #16a34a; }
    .score.mid { color: #f59e0b; }
    .score.bad { color: #dc2626; }
    ul {
      padding-left: 18px;
      margin: 6px 0;
      font-size: 12px;
      color: #374151;
    }
    .section-block {
      border-top: 1px dashed #e5e7eb;
      margin-top: 10px;
      padding-top: 8px;
    }
    .allocation-row {
      display: grid;
      grid-template-columns: 2.3fr 1fr 1fr;
      gap: 8px;
      font-size: 12px;
      margin-top: 4px;
    }
    .allocation-header {
      font-weight: 600;
      color: #4b5563;
    }
    .chart-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    @media (min-width: 720px) {
      .chart-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    canvas {
      background: #f9fafb;
      border-radius: 10px;
      padding: 6px;
    }
  </style>
</head>
<body>
<header>
  <h1>å…«å¤§å…ƒç´ è³‡ç”¢é…ç½®å„€è¡¨æ¿</h1>
  <p>æ•´åˆå®‰å…¨æ€§ã€æµå‹•æ€§ã€æˆé•·æ€§ã€é¢¨éšªåˆ†æ•£ã€ç¾é‡‘æµã€æ§“æ¡¿ã€å®¶åº­éœ€æ±‚èˆ‡å‹•æ…‹èª¿æ•´ï¼Œå¿«é€Ÿçœ‹å‡ºä½ çš„è³‡ç”¢å¥åº·åº¦èˆ‡æœªä¾†è¤‡åˆ©è»Œè·¡ã€‚</p>
</header>

<main>
  <div class="grid">
    <!-- å·¦å´ï¼šè¼¸å…¥å€ -->
    <section class="card">
      <h2>
        è³‡æ–™è¼¸å…¥
        <span class="pill">Step 1ï¼šå¡«å…¥ç›®å‰ç‹€æ³</span>
      </h2>

      <h3>ä¸€ã€è³‡ç”¢èˆ‡è² å‚µæ¦‚æ³</h3>
      <div class="inline-row">
        <div>
          <label for="cashNow">ç¾é‡‘ / æ´»å­˜ï¼ˆé«˜æµå‹•æ€§ï¼‰</label>
          <input id="cashNow" type="number" min="0" placeholder="ä¾‹å¦‚ï¼š500000" />
        </div>
        <div>
          <label for="investNow">æŠ•è³‡å¸‚å€¼ï¼ˆETF / è‚¡ç¥¨ / åŸºé‡‘ï¼‰</label>
          <input id="investNow" type="number" min="0" placeholder="ä¾‹å¦‚ï¼š1200000" />
        </div>
      </div>

      <div class="inline-row">
        <div>
          <label for="propertyValue">æˆ¿ç”¢å¸‚å€¼ç¸½é¡</label>
          <input id="propertyValue" type="number" min="0" placeholder="ä¾‹å¦‚ï¼š35000000" />
        </div>
        <div>
          <label for="mortgageDebt">æˆ¿è²¸æœ¬é‡‘å°šæ¬ ç¸½é¡</label>
          <input id="mortgageDebt" type="number" min="0" placeholder="ä¾‹å¦‚ï¼š20000000" />
        </div>
      </div>

      <div class="inline-row">
        <div>
          <label for="otherDebt">å…¶ä»–è² å‚µï¼ˆè»Šè²¸ / ä¿¡è²¸ / å¡å‚µï¼‰</label>
          <input id="otherDebt" type="number" min="0" value="0" />
        </div>
        <div>
          <label for="singleStock">æœ€å¤§å–®ä¸€è‚¡ç¥¨å¸‚å€¼ï¼ˆçœ‹é›†ä¸­åº¦ï¼‰</label>
          <input id="singleStock" type="number" min="0" value="0" />
        </div>
      </div>

      <p class="small">
        æ·¨è³‡ç”¢ â‰ˆ ç¾é‡‘ + æŠ•è³‡ + æˆ¿ç”¢å¸‚å€¼ âˆ’ è² å‚µï¼ˆæˆ¿è²¸ + å…¶ä»–è² å‚µï¼‰ã€‚é€™æœƒåœ¨å³é‚Šè‡ªå‹•è¨ˆç®—ã€‚
      </p>

      <h3>äºŒã€æ¯æœˆç¾é‡‘æµ & é å‚™é‡‘</h3>
      <div class="inline-row">
        <div>
          <label for="monthlyIncome">æ¯æœˆå¯æ”¯é…æ”¶å…¥ï¼ˆè–ªæ°´ + åˆ†ç´…ï¼‰</label>
          <input id="monthlyIncome" type="number" min="0" placeholder="ä¾‹å¦‚ï¼š300000" />
        </div>
        <div>
          <label for="monthlyExpenses">æ¯æœˆç¸½æ”¯å‡ºï¼ˆå«æˆ¿è²¸ã€å­¸è²»ç­‰ï¼‰</label>
          <input id="monthlyExpenses" type="number" min="0" placeholder="ä¾‹å¦‚ï¼š220000" />
        </div>
      </div>

      <div class="inline-row">
        <div>
          <label for="monthlyMortgagePay">æ¯æœˆæˆ¿è²¸ç¸½é¡</label>
          <input id="monthlyMortgagePay" type="number" min="0" placeholder="ä¾‹å¦‚ï¼š90000" />
        </div>
        <div>
          <label for="emergencyFundNow">ç›®å‰é å‚™é‡‘é‡‘é¡</label>
          <input id="emergencyFundNow" type="number" min="0" placeholder="ä¾‹å¦‚ï¼š400000" />
        </div>
      </div>

      <div class="inline-row">
        <div>
          <label for="emergencyMonths">é å‚™é‡‘ç›®æ¨™æœˆæ•¸</label>
          <input id="emergencyMonths" type="number" min="0" value="12" />
          <div class="small">å¸¸è¦‹ï¼š6 ï½ 12 å€‹æœˆå®¶åº­æ”¯å‡º</div>
        </div>
        <div>
          <label for="lumpIn">é è¨ˆä¸€æ¬¡æ€§æµå…¥ï¼ˆå¦‚è³£æˆ¿ 730 è¬ï¼‰</label>
          <input id="lumpIn" type="number" min="0" value="0" />
        </div>
      </div>

      <h3>ä¸‰ã€å®¶åº­æœªä¾†å¤§é¡æ”¯å‡º</h3>
      <div class="third-row">
        <div>
          <label for="annualEdu">æ¯å¹´æ•™è‚²æ”¯å‡ºï¼ˆå°å­©å­¸è²» + æ‰è—ï¼‰</label>
          <input id="annualEdu" type="number" min="0" value="0" />
        </div>
        <div>
          <label for="bigPlan5y">æœªä¾†äº”å¹´å¤§é¡è¨ˆç•«ï¼ˆè£æ½¢ / æ—…è¡Œ / æ›å±‹æº–å‚™ï¼‰</label>
          <input id="bigPlan5y" type="number" min="0" value="0" />
        </div>
        <div>
          <label for="yearsSim">æ¨¡æ“¬å¹´æ•¸ï¼ˆé è¨­ 5 å¹´ï¼‰</label>
          <input id="yearsSim" type="number" min="1" value="5" />
        </div>
      </div>

      <h3>å››ã€é¢¨éšªåå¥½ & æˆé•·è³‡ç”¢ç›®æ¨™</h3>
      <label for="growthTarget">æˆé•·è³‡ç”¢ç›®æ¨™å æ¯”ï¼ˆETF / è‚¡ç¥¨ï¼‰</label>
      <input id="growthTarget" type="range" min="0" max="70" value="30" />
      <div class="small">
        ç›®å‰ç›®æ¨™ï¼š<span id="growthTargetLabel">30%</span> æ·¨è³‡ç”¢æ”¾åœ¨æˆé•·è³‡ç”¢ã€‚
      </div>

      <label for="riskPref">ç•¶å‰é¢¨éšªåå¥½ï¼ˆé‡å°ã€Œæ–°æŠ•å…¥ã€ï¼‰</label>
      <input id="riskPref" type="range" min="0" max="100" value="50" />
      <div class="small">
        ç›®å‰ï¼š<span id="riskPrefLabel">ä¸­ç­‰</span>ã€‚æ„ˆä¿å®ˆ â†’ æ–°éŒ¢å¤šæ”¾é å‚™é‡‘èˆ‡é‚„å‚µï¼›æ„ˆç©æ¥µ â†’ å¤šæ”¾æˆé•·è³‡ç”¢ã€‚
      </div>

      <button id="calcBtn">è¨ˆç®—è³‡ç”¢å¥åº·åº¦ & æœ¬æœˆè³‡é‡‘è·¯ç”±</button>
      <p class="small mt-8">
        å»ºè­°ï¼šå…ˆç”¨ç¾åœ¨çš„æ•¸å­—æ¸¬è©¦ï¼Œç­‰ 730 è¬æˆ–å…¶ä»–å¤§ç­†è³‡é‡‘å¯¦éš›å…¥å¸³æ™‚ï¼ŒæŠŠ
        ã€Œé è¨ˆä¸€æ¬¡æ€§æµå…¥ã€æ”¹æˆå¯¦éš›é‡‘é¡ï¼Œé‡æ–°è·‘ä¸€æ¬¡ï¼Œç…§å»ºè­°çš„æ¯”ä¾‹åŸ·è¡Œã€‚
      </p>
    </section>

    <!-- å³å´ï¼šçµæœå€ -->
    <section class="card">
      <h2>
        åˆ†æçµæœ
        <span class="pill">Step 2ï¼šæª¢è¦–å…«å¤§å…ƒç´ </span>
      </h2>

      <div id="placeholder">
        <p class="small">
          è«‹å…ˆåœ¨å·¦å´è¼¸å…¥è³‡æ–™ï¼ŒæŒ‰ä¸‹ã€Œè¨ˆç®—è³‡ç”¢å¥åº·åº¦ & æœ¬æœˆè³‡é‡‘è·¯ç”±ã€ã€‚é€™è£¡æœƒé¡¯ç¤ºï¼š
        </p>
        <ul>
          <li>é å‚™é‡‘ã€æµå‹•æ€§ã€æˆé•·æ€§èˆ‡é¢¨éšªåˆ†æ•£æŒ‡æ¨™</li>
          <li>ç¾é‡‘æµã€æ§“æ¡¿ï¼ˆDSCRï¼‰èˆ‡å®¶åº­æ”¯å‡ºè¦†è“‹åº¦</li>
          <li>ç¶œåˆè³‡ç”¢å¥åº·åˆ†æ•¸</li>
          <li>æœ¬æœˆè³‡é‡‘è·¯ç”±å»ºè­°ï¼ˆé å‚™é‡‘ / é‚„å‚µ / æˆé•·è³‡ç”¢ï¼‰</li>
          <li>å…«å¤§å…ƒç´ é›·é”åœ– + æœªä¾†è¤‡åˆ©åœ°åœ–</li>
        </ul>
      </div>

      <div id="result" style="display:none;">
        <div class="section-block">
          <div class="stat-row">
            <span class="label">ä¼°ç®—æ·¨è³‡ç”¢</span>
            <span class="value" id="netWorth"></span>
          </div>
          <div class="stat-row">
            <span class="label">è³‡ç”¢å¥åº·åˆ†æ•¸ï¼ˆ0ï½100ï¼‰</span>
            <span class="value">
              <span id="healthScore" class="score">-</span>
            </span>
          </div>
          <p class="small" id="scoreMsg"></p>
        </div>

        <div class="section-block">
          <h3>1 & 2. å®‰å…¨æ€§ & æµå‹•æ€§</h3>
          <div class="stat-row">
            <span class="label">é å‚™é‡‘ç›®æ¨™</span>
            <span class="value" id="emergencyTarget"></span>
          </div>
          <div class="stat-row">
            <span class="label">é å‚™é‡‘ç¼ºå£</span>
            <span class="value" id="emergencyGap"></span>
          </div>
          <div class="stat-row">
            <span class="label">æµå‹•æ€§æ¯”ç‡ï¼ˆç¾é‡‘ Ã· æ·¨è³‡ç”¢ï¼‰</span>
            <span class="value" id="liqRatio"></span>
          </div>
          <p class="small" id="safetyMsg"></p>
          <span id="safetyBadge" class="badge"></span>
          <span id="liqBadge" class="badge"></span>
        </div>

        <div class="section-block">
          <h3>3 & 4. æˆé•·æ€§ & é¢¨éšªåˆ†æ•£</h3>
          <div class="stat-row">
            <span class="label">ç›®å‰æˆé•·è³‡ç”¢æ¯”ç‡ï¼ˆæŠ•è³‡ Ã· æ·¨è³‡ç”¢ï¼‰</span>
            <span class="value" id="growthRatio"></span>
          </div>
          <div class="stat-row">
            <span class="label">æˆ¿ç”¢å æ¯”ï¼ˆæˆ¿ç”¢å¸‚å€¼ Ã· æ·¨è³‡ç”¢ï¼‰</span>
            <span class="value" id="propRatio"></span>
          </div>
          <div class="stat-row">
            <span class="label">æœ€å¤§å–®ä¸€è‚¡ç¥¨é›†ä¸­åº¦</span>
            <span class="value" id="singleStockRatio"></span>
          </div>
          <p class="small" id="growthMsg"></p>
          <span id="growthBadge" class="badge"></span>
          <span id="divBadge" class="badge"></span>
        </div>

        <div class="section-block">
          <h3>5 & 6. ç¾é‡‘æµ & æ§“æ¡¿</h3>
          <div class="stat-row">
            <span class="label">æ¯æœˆè‡ªç”±ç¾é‡‘æµï¼ˆæ”¶å…¥ âˆ’ æ”¯å‡ºï¼‰</span>
            <span class="value" id="freeCash"></span>
          </div>
          <div class="stat-row">
            <span class="label">æ¯æœˆæˆ¿è²¸ç¸½é¡</span>
            <span class="value" id="mortgagePayOut"></span>
          </div>
          <div class="stat-row">
            <span class="label">ç°¡æ˜“ DSCRï¼ˆ>1.2 è¼ƒå®‰å…¨ï¼‰</span>
            <span class="value" id="dscr"></span>
          </div>
          <p class="small" id="cashflowMsg"></p>
          <span id="cashflowBadge" class="badge"></span>
          <span id="dscrBadge" class="badge"></span>
        </div>

        <div class="section-block">
          <h3>7. å®¶åº­å°å‘ï¼ˆæ•™è‚² & å¤§é¡æ”¯å‡ºï¼‰</h3>
          <div class="stat-row">
            <span class="label">æœªä¾†äº”å¹´æ•™è‚²æ”¯å‡ºç¸½é¡</span>
            <span class="value" id="edu5y"></span>
          </div>
          <div class="stat-row">
            <span class="label">æœªä¾†äº”å¹´å¤§é¡è¨ˆç•«ï¼ˆè£æ½¢ / æ—…éŠç­‰ï¼‰</span>
            <span class="value" id="bigPlan5yOut"></span>
          </div>
          <div class="stat-row">
            <span class="label">äº”å¹´ç¸½éœ€æ±‚ï¼ˆæ•™è‚² + å¤§é¡æ”¯å‡ºï¼‰</span>
            <span class="value" id="familyNeedTotal"></span>
          </div>
          <p class="small" id="familyMsg"></p>
          <span id="familyBadge" class="badge"></span>
        </div>

        <div class="section-block">
          <h3>8. å‹•æ…‹èª¿æ•´ï¼šæœ¬æ¬¡ã€Œæ–°è³‡é‡‘ã€è·¯ç”±å»ºè­°</h3>
          <p class="small">
            ä»¥ã€Œæ‰‹ä¸Šç¾é‡‘ + é è¨ˆä¸€æ¬¡æ€§æµå…¥ã€ç‚ºåŸºæº–ï¼Œä¾å®‰å…¨æ€§ / æ§“æ¡¿ / é¢¨éšªåå¥½åˆ†é…åˆ°ä¸‰å€‹æ¡¶ï¼šé å‚™é‡‘ã€é‚„å‚µã€æˆé•·è³‡ç”¢ã€‚
          </p>

          <div class="stat-row">
            <span class="label">æœ¬æ¬¡å¯é‹ç”¨ç¾é‡‘ï¼ˆç¾é‡‘ + ä¸€æ¬¡æ€§æµå…¥ï¼‰</span>
            <span class="value" id="totalAvailable"></span>
          </div>

          <div class="allocation-row allocation-header mt-4">
            <div>è³‡é‡‘ç”¨é€”</div>
            <div>é‡‘é¡</div>
            <div>ä½”æœ¬æ¬¡è³‡é‡‘</div>
          </div>
          <div class="allocation-row">
            <div>1ï¸âƒ£ è£œè¶³é å‚™é‡‘</div>
            <div id="allocEmergency"></div>
            <div id="allocEmergencyPct"></div>
          </div>
          <div class="allocation-row">
            <div>2ï¸âƒ£ æˆ¿è²¸ / è² å‚µæå‰é‚„æ¬¾</div>
            <div id="allocDebt"></div>
            <div id="allocDebtPct"></div>
          </div>
          <div class="allocation-row">
            <div>3ï¸âƒ£ æˆé•·è³‡ç”¢ï¼ˆETF / é•·ç·šè‚¡ç¥¨ï¼‰</div>
            <div id="allocGrowth"></div>
            <div id="allocGrowthPct"></div>
          </div>

          <div class="highlight-box mt-8" id="routingMsg"></div>
          <div class="highlight-box mt-8" id="adviceText"></div>
        </div>

        <!-- è¦–è¦ºåŒ–ï¼šé›·é”åœ– + è¤‡åˆ©åœ°åœ– -->
        <div class="section-block">
          <h3>è¦–è¦ºåŒ–ï¼šå…«å¤§å…ƒç´ é›·é”åœ– & æ·¨è³‡ç”¢è¤‡åˆ©åœ°åœ–</h3>
          <div class="chart-grid">
            <div>
              <p class="small">å…«å¤§å…ƒç´ é›·é”åœ–ï¼ˆåˆ†æ•¸æ„ˆé å¤–ä»£è¡¨æ„ˆå¥åº·ï¼‰</p>
              <canvas id="radarChart" height="240"></canvas>
            </div>
            <div>
              <p class="small">æœªä¾†æ·¨è³‡ç”¢è¤‡åˆ©åœ°åœ–ï¼ˆå‡è¨­ç©©å®šæŠ•å…¥èˆ‡åˆç†å ±é…¬ï¼‰</p>
              <canvas id="growthChart" height="240"></canvas>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</main>

<script>
  function parseNumber(id) {
    var v = document.getElementById(id).value.trim();
    var n = parseFloat(v);
    if (isNaN(n) || !isFinite(n)) return 0;
    return Math.max(0, n);
  }

  function formatMoney(n) {
    return n.toLocaleString("zh-TW", {
      style: "currency",
      currency: "TWD",
      maximumFractionDigits: 0
    });
  }

  function formatPercent01(x) {
    return (x * 100).toFixed(1) + "%";
  }

  const growthSlider = document.getElementById("growthTarget");
  const growthLabel = document.getElementById("growthTargetLabel");
  const riskSlider = document.getElementById("riskPref");
  const riskLabel = document.getElementById("riskPrefLabel");

  function updateGrowthLabel() {
    growthLabel.textContent = growthSlider.value + "%";
  }

  function updateRiskLabel() {
    var v = parseInt(riskSlider.value, 10);
    var t = "ä¸­ç­‰";
    if (v <= 20) t = "éå¸¸ä¿å®ˆ";
    else if (v <= 40) t = "åä¿å®ˆ";
    else if (v <= 60) t = "ä¸­ç­‰";
    else if (v <= 80) t = "åç©æ¥µ";
    else t = "éå¸¸ç©æ¥µ";
    riskLabel.textContent = t;
  }

  growthSlider.addEventListener("input", updateGrowthLabel);
  riskSlider.addEventListener("input", updateRiskLabel);
  updateGrowthLabel();
  updateRiskLabel();

  // Chart.js å¯¦ä¾‹
  let radarChartInstance = null;
  let growthChartInstance = null;

  function renderRadarChart(scores) {
    var ctx = document.getElementById("radarChart").getContext("2d");
    if (radarChartInstance) radarChartInstance.destroy();
    radarChartInstance = new Chart(ctx, {
      type: "radar",
      data: {
        labels: [
          "å®‰å…¨æ€§",
          "æµå‹•æ€§",
          "æˆé•·æ€§",
          "åˆ†æ•£åº¦",
          "ç¾é‡‘æµ",
          "æ§“æ¡¿",
          "å®¶åº­éœ€æ±‚",
          "å‹•æ…‹èª¿æ•´"
        ],
        datasets: [
          {
            label: "è³‡ç”¢å¥åº·åˆ†æ•¸ï¼ˆ0â€“100ï¼‰",
            data: scores,
            fill: true,
            borderWidth: 2,
            pointRadius: 3
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          r: {
            suggestedMin: 0,
            suggestedMax: 100,
            ticks: {
              stepSize: 20,
              display: true
            },
            angleLines: { display: true },
            grid: { display: true }
          }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });
  }

  function renderGrowthChart(netWorthNow, annualContribution, annualRate, years) {
    var ctx = document.getElementById("growthChart").getContext("2d");
    if (growthChartInstance) growthChartInstance.destroy();

    var labels = [];
    var data = [];
    var value = netWorthNow;

    for (var i = 0; i <= years; i++) {
      labels.push("ç¬¬ " + i + " å¹´");
      data.push(Math.max(0, value));
      value = value * (1 + annualRate) + annualContribution;
    }

    growthChartInstance = new Chart(ctx, {
      type: "line",
      data: {
        labels: labels,
        datasets: [
          {
            label: "é ä¼°æ·¨è³‡ç”¢",
            data: data,
            borderWidth: 2,
            tension: 0.25,
            pointRadius: 2,
            fill: false
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        },
        scales: {
          x: { title: { display: false } },
          y: {
            title: { display: false },
            ticks: {
              callback: function(value) {
                return "NT$ " + (value / 1000000).toFixed(1) + "M";
              }
            }
          }
        }
      }
    });
  }

  document.getElementById("calcBtn").addEventListener("click", function () {
    // è®€å–è¼¸å…¥
    var cash = parseNumber("cashNow");
    var invest = parseNumber("investNow");
    var propVal = parseNumber("propertyValue");
    var mortgageDebt = parseNumber("mortgageDebt");
    var otherDebt = parseNumber("otherDebt");
    var singleStock = parseNumber("singleStock");
    var monthlyIncome = parseNumber("monthlyIncome");
    var monthlyExpenses = parseNumber("monthlyExpenses");
    var monthlyMortgagePay = parseNumber("monthlyMortgagePay");
    var emergencyFundNow = parseNumber("emergencyFundNow");
    var emergencyMonths = parseNumber("emergencyMonths");
    var lumpIn = parseNumber("lumpIn");
    var annualEdu = parseNumber("annualEdu");
    var bigPlan5y = parseNumber("bigPlan5y");
    var yearsSim = parseNumber("yearsSim") || 5;

    var growthTargetPct = parseInt(growthSlider.value, 10) / 100;
    var risk = parseInt(riskSlider.value, 10) / 100;

    // æ·¨è³‡ç”¢
    var totalAssets = cash + invest + propVal;
    var totalDebt = mortgageDebt + otherDebt;
    var netWorth = totalAssets - totalDebt;

    if (netWorth <= 0) {
      alert("ç›®å‰æ·¨è³‡ç”¢è¨ˆç®—ç‚º 0 æˆ–ä»¥ä¸‹ï¼Œè«‹ç¢ºèªè³‡ç”¢èˆ‡è² å‚µæ•¸å­—æ˜¯å¦æ­£ç¢ºã€‚");
      return;
    }

    // Element 1ï¼šå®‰å…¨æ€§
    var emergencyTarget = monthlyExpenses * emergencyMonths;
    var emergencyGap = Math.max(0, emergencyTarget - emergencyFundNow);

    // Element 2ï¼šæµå‹•æ€§
    var liqRatio = cash / netWorth;

    // Element 3ï¼šæˆé•·æ€§
    var growthRatio = invest / netWorth;

    // Element 4ï¼šé¢¨éšªåˆ†æ•£
    var propRatio = propVal / netWorth;
    var singleStockRatio = invest > 0 ? singleStock / invest : 0;

    // Element 5ï¼šç¾é‡‘æµ
    var freeCash = monthlyIncome - monthlyExpenses;

    // Element 6ï¼šæ§“æ¡¿ï¼ˆDSCRï¼‰
    var nonDebtExpenses = Math.max(0, monthlyExpenses - monthlyMortgagePay);
    var dscr = null;
    if (monthlyMortgagePay > 0 && monthlyIncome > 0) {
      var noi = monthlyIncome - nonDebtExpenses;
      dscr = noi / monthlyMortgagePay;
    }

    // Element 7ï¼šå®¶åº­å°å‘
    var eduTotal = annualEdu * yearsSim;
    var familyNeedTotal = eduTotal + bigPlan5y;
    var freeCashYear = freeCash * 12;
    var freeCashTotal = freeCashYear * yearsSim;
    var familyCoverBase = emergencyFundNow + Math.max(0, freeCashTotal);
    var familyCoverRatio = familyNeedTotal > 0 ? familyCoverBase / familyNeedTotal : 1;

    // Element 8ï¼šå‹•æ…‹èª¿æ•´ï¼ˆè³‡é‡‘è·¯ç”±ï¼‰
    var totalAvailable = cash + lumpIn;
    if (totalAvailable <= 0) {
      alert("è«‹è‡³å°‘åœ¨ã€Œç¾é‡‘ / æ´»å­˜ã€æˆ–ã€Œé è¨ˆä¸€æ¬¡æ€§æµå…¥ã€è¼¸å…¥ä¸€é»é‡‘é¡ã€‚");
      return;
    }

    var allocEmergency = Math.min(emergencyGap, totalAvailable);
    var remainAfterEmergency = totalAvailable - allocEmergency;

    var growthWeight = 0.3 + 0.4 * risk; // 0.3~0.7
    var debtWeight = 1 - growthWeight;

    if (dscr !== null && dscr < 1.0) {
      debtWeight = Math.min(0.85, debtWeight + 0.3);
      growthWeight = 1 - debtWeight;
    } else if (dscr !== null && dscr < 1.2) {
      debtWeight = Math.min(0.75, debtWeight + 0.15);
      growthWeight = 1 - debtWeight;
    }

    var allocDebt = remainAfterEmergency * debtWeight;
    var allocGrowth = remainAfterEmergency * growthWeight;

    var allocEmPct = allocEmergency / totalAvailable || 0;
    var allocDebtPct = allocDebt / totalAvailable || 0;
    var allocGrPct = allocGrowth / totalAvailable || 0;

    // è³‡ç”¢å¥åº·åˆ†æ•¸
    function scoreSafety(gap, target) {
      if (target === 0) return 60;
      var ratio = (target - gap) / target;
      if (ratio >= 1) return 95;
      if (ratio >= 0.7) return 80;
      if (ratio >= 0.4) return 60;
      return 40;
    }
    function scoreLiquidity(r) {
      if (r >= 0.2 && r <= 0.4) return 90;
      if (r >= 0.1 && r < 0.2) return 75;
      if (r > 0.4 && r <= 0.6) return 70;
      if (r >= 0.05 && r < 0.1) return 55;
      return 40;
    }
    function scoreGrowth(gr, target) {
      if (target === 0) return 60;
      var diff = Math.abs(gr - target);
      if (diff <= 0.05) return 90;
      if (diff <= 0.10) return 75;
      if (diff <= 0.20) return 60;
      return 45;
    }
    function scoreDiversify(pr, ssr) {
      var s = 90;
      if (pr > 0.7) s -= 25;
      else if (pr > 0.6) s -= 15;
      if (ssr > 0.4) s -= 25;
      else if (ssr > 0.25) s -= 15;
      return Math.max(30, s);
    }
    function scoreCashflow(fc) {
      if (fc <= 0) return 40;
      var ratio = fc / (monthlyIncome || 1);
      if (ratio >= 0.3) return 90;
      if (ratio >= 0.15) return 80;
      if (ratio >= 0.05) return 70;
      return 55;
    }
    function scoreLeverage(d) {
      if (d === null) return 60;
      if (d < 1.0) return 40;
      if (d < 1.2) return 60;
      if (d < 1.5) return 75;
      return 90;
    }
    function scoreFamily(fr) {
      if (familyNeedTotal === 0) return 70;
      if (fr >= 1.2) return 90;
      if (fr >= 1.0) return 80;
      if (fr >= 0.7) return 65;
      return 45;
    }

    var s1 = scoreSafety(emergencyGap, emergencyTarget);
    var s2 = scoreLiquidity(liqRatio);
    var s3 = scoreGrowth(growthRatio, growthTargetPct);
    var s4 = scoreDiversify(propRatio, singleStockRatio);
    var s5 = scoreCashflow(freeCash);
    var s6 = scoreLeverage(dscr);
    var s7 = scoreFamily(familyCoverRatio);
    var s8 = 80; // å‹•æ…‹èª¿æ•´å¯ä»¥è¦–ç‚ºé è¨­è‰¯å¥½ï¼Œä¹‹å¾Œä½ è¦å¯å†æ”¹æˆæ›´ç²¾ç´°

    var healthScore =
      s1 * 0.2 +
      s2 * 0.1 +
      s3 * 0.2 +
      s4 * 0.1 +
      s5 * 0.15 +
      s6 * 0.15 +
      s7 * 0.05 +
      s8 * 0.05;

    // ç•«é¢æ›´æ–°
    document.getElementById("placeholder").style.display = "none";
    document.getElementById("result").style.display = "block";

    document.getElementById("netWorth").textContent = formatMoney(netWorth);
    var scoreEl = document.getElementById("healthScore");
    scoreEl.textContent = Math.round(healthScore);
    scoreEl.classList.remove("good", "mid", "bad");
    var scoreMsg = "";
    if (healthScore >= 80) {
      scoreEl.classList.add("good");
      scoreMsg = "æ•´é«”è³‡ç”¢å¥åº·ä¸éŒ¯ï¼Œå¯ä»¥åœ¨ç¶­æŒå®‰å…¨æ€§çš„å‰æä¸‹ï¼Œèšç„¦æˆé•·è³‡ç”¢èˆ‡äº‹æ¥­å¸ƒå±€ã€‚";
    } else if (healthScore >= 60) {
      scoreEl.classList.add("mid");
      scoreMsg = "è³‡ç”¢é«”è³ªåœ¨å¯æ¥å—ç¯„åœï¼Œä½†æŸäº›å€å¡Šï¼ˆä¾‹å¦‚é å‚™é‡‘ã€æ§“æ¡¿æˆ–é›†ä¸­åº¦ï¼‰éœ€è¦å¾®èª¿ã€‚";
    } else {
      scoreEl.classList.add("bad");
      scoreMsg = "ç›®å‰é¢¨éšªåé«˜ï¼Œå»ºè­°å…ˆå¼·åŒ–é å‚™é‡‘ã€æ¸›å°‘æ§“æ¡¿æˆ–é›†ä¸­åº¦ï¼Œå†è«‡ç©æ¥µæŠ•è³‡ã€‚";
    }
    document.getElementById("scoreMsg").textContent = scoreMsg;

    // å®‰å…¨ & æµå‹•æ€§
    document.getElementById("emergencyTarget").textContent = formatMoney(emergencyTarget);
    document.getElementById("emergencyGap").textContent = formatMoney(emergencyGap);
    document.getElementById("liqRatio").textContent = formatPercent01(liqRatio);

    var safetyMsg = "";
    var safetyBadge = document.getElementById("safetyBadge");
    safetyBadge.className = "badge";
    if (emergencyTarget === 0) {
      safetyMsg = "å°šæœªè¨­å®šé å‚™é‡‘ç›®æ¨™ï¼Œå¯è€ƒæ…®ä»¥ 6ï½12 å€‹æœˆå®¶åº­æ”¯å‡ºä½œç‚ºåŸºæº–ã€‚";
      safetyBadge.textContent = "é å‚™é‡‘ï¼šå»ºè­°è¨­å®šç›®æ¨™";
      safetyBadge.classList.add("yellow");
    } else if (emergencyGap <= 0) {
      safetyMsg = "é å‚™é‡‘å·²é”æˆ–è¶…éç›®æ¨™ï¼Œå®‰å…¨å¢Šå……è¶³ï¼Œå¯ä»¥æŠŠæ–°è³‡é‡‘æ›´å¤šåˆ†é…åœ¨é‚„å‚µèˆ‡æˆé•·è³‡ç”¢ã€‚";
      safetyBadge.textContent = "é å‚™é‡‘ï¼šå……è¶³";
      safetyBadge.classList.add("green");
    } else if (emergencyGap <= emergencyTarget * 0.3) {
      safetyMsg = "é å‚™é‡‘æ¥è¿‘ç›®æ¨™ï¼Œå»ºè­°æ¥ä¸‹ä¾†å¹¾æ¬¡ç¾é‡‘æµå„ªå…ˆè£œæ»¿ç¼ºå£ã€‚";
      safetyBadge.textContent = "é å‚™é‡‘ï¼šæ¥è¿‘ç›®æ¨™";
      safetyBadge.classList.add("yellow");
    } else {
      safetyMsg = "é å‚™é‡‘èˆ‡ç›®æ¨™å·®è·è¼ƒå¤§ï¼Œå»ºè­°çŸ­æœŸæ–°è³‡é‡‘å„ªå…ˆå¡«è£œå®‰å…¨å¢Šï¼Œé¿å…æ„å¤–äº‹ä»¶å£“åŠ›éå¤§ã€‚";
      safetyBadge.textContent = "é å‚™é‡‘ï¼šåä¸è¶³";
      safetyBadge.classList.add("red");
    }

    var liqBadge = document.getElementById("liqBadge");
    liqBadge.className = "badge";
    var liqText = "";
    if (liqRatio >= 0.2 && liqRatio <= 0.4) {
      liqText = "æµå‹•æ€§ï¼šè‰¯å¥½";
      liqBadge.classList.add("green");
    } else if (liqRatio >= 0.1 && liqRatio < 0.2) {
      liqText = "æµå‹•æ€§ï¼šç•¥ä½";
      liqBadge.classList.add("yellow");
    } else if (liqRatio > 0.4 && liqRatio <= 0.6) {
      liqText = "æµå‹•æ€§ï¼šåé«˜ï¼ˆç¾é‡‘å¯èƒ½å¤ªå¤šï¼‰";
      liqBadge.classList.add("yellow");
    } else {
      liqText = "æµå‹•æ€§ï¼šéœ€æ³¨æ„ï¼ˆç¾é‡‘åå°‘æˆ–æ¥µåº¦é›†ä¸­ï¼‰";
      liqBadge.classList.add("red");
    }
    liqBadge.textContent = liqText;
    document.getElementById("safetyMsg").textContent = safetyMsg;

    // æˆé•·æ€§ & åˆ†æ•£
    document.getElementById("growthRatio").textContent = formatPercent01(growthRatio);
    document.getElementById("propRatio").textContent = formatPercent01(propRatio);
    document.getElementById("singleStockRatio").textContent = formatPercent01(singleStockRatio);

    var growthMsg = "";
    var growthBadge = document.getElementById("growthBadge");
    growthBadge.className = "badge";
    var diffGrowth = growthRatio - growthTargetPct;
    if (growthTargetPct === 0) {
      growthMsg = "å°šæœªè¨­å®šæˆé•·è³‡ç”¢ç›®æ¨™æ¯”ä¾‹ï¼Œå¯ä»¥ä¾å¹´é½¡èˆ‡é¢¨éšªåå¥½ï¼Œè¨­å®š 20ï½60% çš„é•·æœŸç›®æ¨™ã€‚";
      growthBadge.textContent = "æˆé•·æ€§ï¼šéœ€è¨‚ç›®æ¨™";
      growthBadge.classList.add("yellow");
    } else if (Math.abs(diffGrowth) <= 0.05) {
      growthMsg = "æˆé•·è³‡ç”¢æ¯”ä¾‹æ¥è¿‘ä½ çš„ç›®æ¨™ï¼Œç¯€å¥ç©©å®šï¼Œå¯ä»¥å°ˆæ³¨åœ¨æŒçºŒæŠ•å…¥èˆ‡é¸æ¨™çš„å“è³ªã€‚";
      growthBadge.textContent = "æˆé•·æ€§ï¼šæ¥è¿‘ç›®æ¨™";
      growthBadge.classList.add("green");
    } else if (diffGrowth < -0.05) {
      growthMsg = "ç›®å‰æˆé•·è³‡ç”¢æ¯”ä¾‹ä½æ–¼ç›®æ¨™ï¼Œä»£è¡¨åä¿å®ˆï¼Œè‹¥å®‰å…¨å¢Šè¶³å¤ ï¼Œå¯é€æ­¥åŠ å¤§é•·æœŸ ETF / è‚¡ç¥¨çš„æ¯”é‡ã€‚";
      growthBadge.textContent = "æˆé•·æ€§ï¼šåä¿å®ˆ";
      growthBadge.classList.add("yellow");
    } else {
      growthMsg = "ç›®å‰æˆé•·è³‡ç”¢æ¯”ä¾‹é«˜æ–¼ç›®æ¨™ï¼Œè‹¥é…åˆæ§“æ¡¿èˆ‡ç¾é‡‘æµå£“åŠ›ï¼Œéœ€ç•™æ„æ³¢å‹•é¢¨éšªèˆ‡å›æ’¤ã€‚";
      growthBadge.textContent = "æˆé•·æ€§ï¼šåç©æ¥µ";
      growthBadge.classList.add("yellow");
    }

    var divBadge = document.getElementById("divBadge");
    divBadge.className = "badge";
    var divText = "";
    if (propRatio > 0.7 && singleStockRatio > 0.4) {
      divText = "åˆ†æ•£ï¼šæˆ¿ç”¢é‡ & å–®ä¸€è‚¡ç¥¨é›†ä¸­";
      divBadge.classList.add("red");
    } else if (propRatio > 0.7 || singleStockRatio > 0.4) {
      divText = "åˆ†æ•£ï¼šæœ‰æ˜é¡¯é›†ä¸­é¢¨éšª";
      divBadge.classList.add("yellow");
    } else if (propRatio > 0.6 || singleStockRatio > 0.25) {
      divText = "åˆ†æ•£ï¼šç¨åé›†ä¸­ï¼Œå¯é€æ­¥åˆ†æ•£ã€‚";
      divBadge.classList.add("yellow");
    } else {
      divText = "åˆ†æ•£ï¼šå°šå¯ï¼Œä»å¯è¦–ç‹€æ³å¾®èª¿ã€‚";
      divBadge.classList.add("green");
    }
    divBadge.textContent = divText;
    document.getElementById("growthMsg").textContent = growthMsg;

    // ç¾é‡‘æµ & æ§“æ¡¿
    document.getElementById("freeCash").textContent = formatMoney(freeCash);
    document.getElementById("mortgagePayOut").textContent = formatMoney(monthlyMortgagePay);
    var dscrText = "-";
    if (dscr !== null && isFinite(dscr)) {
      dscrText = dscr.toFixed(2);
    }
    document.getElementById("dscr").textContent = dscrText;

    var cashflowMsg = "";
    var cashflowBadge = document.getElementById("cashflowBadge");
    cashflowBadge.className = "badge";
    if (freeCash <= 0) {
      cashflowMsg = "ç›®å‰æ¯æœˆè‡ªç”±ç¾é‡‘æµå°æ–¼ç­‰æ–¼ 0ï¼Œå»ºè­°å…ˆèª¿æ•´æ”¯å‡ºæˆ–æå‡æ”¶å…¥ï¼Œå¦å‰‡å³ä½¿è³‡ç”¢é…ç½®å†å¥½ä¹Ÿæœƒæ„Ÿåˆ°åƒåŠ›ã€‚";
      cashflowBadge.textContent = "ç¾é‡‘æµï¼šç·Šç¹ƒ";
      cashflowBadge.classList.add("red");
    } else {
      var ratioFC = freeCash / (monthlyIncome || 1);
      if (ratioFC >= 0.3) {
        cashflowMsg = "è‡ªç”±ç¾é‡‘æµå……è£•ï¼Œå¯ä»¥æ¯æœˆå›ºå®šé…ç½®åˆ°æˆé•·è³‡ç”¢èˆ‡é‚„å‚µï¼Œç©©å®šæ‹‰å‡æ·¨è³‡ç”¢ã€‚";
        cashflowBadge.textContent = "ç¾é‡‘æµï¼šå……è£•";
        cashflowBadge.classList.add("green");
      } else if (ratioFC >= 0.15) {
        cashflowMsg = "è‡ªç”±ç¾é‡‘æµå°šå¯ï¼Œç¶“éæœ‰è¨ˆç•«çš„åˆ†é…ï¼ˆé å‚™é‡‘ / é‚„å‚µ / æŠ•è³‡ï¼‰ï¼Œå¯ä»¥é€æ­¥æ”¹å–„è³‡ç”¢é«”è³ªã€‚";
        cashflowBadge.textContent = "ç¾é‡‘æµï¼šå°šå¯";
        cashflowBadge.classList.add("yellow");
      } else {
        cashflowMsg = "è‡ªç”±ç¾é‡‘æµåå°‘ï¼ŒçŸ­æœŸå…§æ–°è³‡é‡‘å»ºè­°å„ªå…ˆå¼·åŒ–é å‚™é‡‘èˆ‡æ¸›å°‘æ§“æ¡¿ã€‚";
        cashflowBadge.textContent = "ç¾é‡‘æµï¼šåå°‘";
        cashflowBadge.classList.add("yellow");
      }
    }

    var dscrBadge = document.getElementById("dscrBadge");
    dscrBadge.className = "badge";
    var dscrMsg = "";
    if (dscr === null || !isFinite(dscr)) {
      dscrMsg = "å¦‚è¦æ›´ç²¾æº–è©•ä¼°æ§“æ¡¿é¢¨éšªï¼Œè«‹ç¢ºèªæ¯æœˆæˆ¿è²¸èˆ‡æ”¶å…¥æ¬„ä½çš†æœ‰å¡«å¯«ã€‚";
      dscrBadge.textContent = "DSCRï¼šè³‡æ–™ä¸è¶³";
      dscrBadge.classList.add("yellow");
    } else if (dscr < 1.0) {
      dscrMsg = "DSCR ä½æ–¼ 1ï¼Œå‚µå‹™å„Ÿå‚µèƒ½åŠ›åå¼±ï¼Œå»ºè­°å„ªå…ˆæ¸›å°‘æ§“æ¡¿æˆ–å¢åŠ æ”¶å…¥ï¼Œé¿å…æ–°å¢å¤§é¡è² å‚µã€‚";
      dscrBadge.textContent = "DSCRï¼šåå±éšª";
      dscrBadge.classList.add("red");
    } else if (dscr < 1.2) {
      dscrMsg = "DSCR ä»‹æ–¼ 1ï½1.2ï¼Œå°šå¯ä½†ç·Šç¹ƒï¼Œè¿‘æœŸä¸å®œå¤§å¹…å¢åŠ æˆ¿è²¸æˆ–æŠ•è³‡æ§“æ¡¿ã€‚";
      dscrBadge.textContent = "DSCRï¼šåç·Š";
      dscrBadge.classList.add("yellow");
    } else if (dscr < 1.5) {
      dscrMsg = "DSCR è¶…é 1.2ï¼Œæ§“æ¡¿åœ¨å¯æ§ç¯„åœå…§ï¼Œå¯ä»¥æ­é…é¢¨éšªåå¥½åšæœ‰ç¯€å¥çš„æŠ•è³‡ã€‚";
      dscrBadge.textContent = "DSCRï¼šå®‰å…¨";
      dscrBadge.classList.add("green");
    } else {
      dscrMsg = "DSCR è¶…é 1.5ï¼Œå‚µå‹™å„Ÿå‚µèƒ½åŠ›ç›¸å°å……è£•ï¼Œå¯ä»¥è¦–äººç”Ÿè¦åŠƒè©•ä¼°æ›å±‹æˆ–å¢åŠ æˆé•·è³‡ç”¢æ¯”ä¾‹ã€‚";
      dscrBadge.textContent = "DSCRï¼šå……è£•";
      dscrBadge.classList.add("green");
    }

    document.getElementById("cashflowMsg").textContent = cashflowMsg + " " + dscrMsg;

    // å®¶åº­å°å‘
    document.getElementById("edu5y").textContent = formatMoney(eduTotal);
    document.getElementById("bigPlan5yOut").textContent = formatMoney(bigPlan5y);
    document.getElementById("familyNeedTotal").textContent = formatMoney(familyNeedTotal);

    var familyMsg = "";
    var familyBadge = document.getElementById("familyBadge");
    familyBadge.className = "badge";
    if (familyNeedTotal === 0) {
      familyMsg = "å°šæœªè¼¸å…¥æœªä¾†æ•™è‚²èˆ‡å¤§é¡æ”¯å‡ºï¼Œå»ºè­°æŠŠã€Œä½ å·²ç¶“çŸ¥é“ä¸€å®šæœƒç™¼ç”Ÿçš„äº‹æƒ…ã€å…ˆä¼°é€²ä¾†ï¼Œæ¨¡å‹æœƒæ›´è²¼è¿‘çœŸå¯¦äººç”Ÿã€‚";
      familyBadge.textContent = "å®¶åº­éœ€æ±‚ï¼šå°šæœªè¨­å®š";
      familyBadge.classList.add("yellow");
    } else if (familyCoverRatio >= 1.2) {
      familyMsg = "ä¾ç›®å‰é å‚™é‡‘èˆ‡æœªä¾†å¯ç´¯ç©è‡ªç”±ç¾é‡‘æµï¼Œä½ å¤§è‡´å¯ä»¥è¦†è“‹æœªä¾† " + yearsSim + " å¹´çš„æ•™è‚²èˆ‡å¤§é¡æ”¯å‡ºï¼Œå£“åŠ›ç›¸å°å¯æ§ã€‚";
      familyBadge.textContent = "å®¶åº­éœ€æ±‚ï¼šå¯è¢«æ”¯æ’";
      familyBadge.classList.add("green");
    } else if (familyCoverRatio >= 1.0) {
      familyMsg = "è‹¥æœªä¾†æ”¶å…¥èˆ‡æ”¯å‡ºç¶­æŒç¾åœ¨çš„ç¯€å¥ï¼Œæ•´é«”ä¸Šå‹‰å¼·èƒ½æ”¯æ’å®¶åº­éœ€æ±‚ï¼Œä½†é‡åˆ°æ„å¤–æœƒè¼ƒåƒç·Šã€‚å¯ä»¥é©åº¦æé«˜é å‚™é‡‘æˆ–å¢åŠ æ”¶å…¥ã€‚";
      familyBadge.textContent = "å®¶åº­éœ€æ±‚ï¼šå‹‰å¼·æ”¯æ’";
      familyBadge.classList.add("yellow");
    } else {
      familyMsg = "ä»¥ç›®å‰é å‚™é‡‘ + é ä¼°è‡ªç”±ç¾é‡‘æµï¼Œå¯èƒ½ç„¡æ³•å®Œå…¨è¦†è“‹æœªä¾† " + yearsSim + " å¹´çš„æ•™è‚²èˆ‡å¤§é¡æ”¯å‡ºï¼Œå»ºè­°é‡æ–°æª¢è¦–ï¼šæ”¯å‡ºç¯€å¥ / æŠ•è³‡å ±é…¬ / æ§“æ¡¿é€Ÿåº¦ã€‚";
      familyBadge.textContent = "å®¶åº­éœ€æ±‚ï¼šååƒç·Š";
      familyBadge.classList.add("red");
    }
    document.getElementById("familyMsg").textContent = familyMsg;

    // å‹•æ…‹èª¿æ•´ï¼šè³‡é‡‘è·¯ç”±
    document.getElementById("totalAvailable").textContent = formatMoney(totalAvailable);
    document.getElementById("allocEmergency").textContent = formatMoney(allocEmergency);
    document.getElementById("allocDebt").textContent = formatMoney(allocDebt);
    document.getElementById("allocGrowth").textContent = formatMoney(allocGrowth);
    document.getElementById("allocEmergencyPct").textContent = formatPercent01(allocEmPct);
    document.getElementById("allocDebtPct").textContent = formatPercent01(allocDebtPct);
    document.getElementById("allocGrowthPct").textContent = formatPercent01(allocGrPct);

    var routingMsg =
      "æŠŠæ¯æ¬¡çš„å¤§é¡ç¾é‡‘ï¼ˆä¾‹å¦‚ï¼šçé‡‘ã€è³£æˆ¿æ¬¾ï¼‰è¦–ç‚ºä¸€æ‰¹ã€Œæ–°è³‡é‡‘ã€ï¼Œå…ˆä¾ä¸Šæ–¹æ¯”ä¾‹åˆ†é…åˆ°ä¸‰å€‹æ¡¶ï¼šã€Œå®‰å…¨é å‚™é‡‘ â†’ é‚„å‚µ â†’ æˆé•·è³‡ç”¢ã€ã€‚" +
      "ç•¶é å‚™é‡‘å·²é”ç›®æ¨™ã€DSCR åˆåœ¨å®‰å…¨ç¯„åœæ™‚ï¼Œæœªä¾†å°±å¯ä»¥é€æ­¥é™ä½é‚„å‚µå æ¯”ã€æ‹‰é«˜æˆé•·è³‡ç”¢å æ¯”ã€‚";
    document.getElementById("routingMsg").textContent = routingMsg;

    var adviceLines = [];
    adviceLines.push("â€¢ å…ˆç¢ºèªé å‚™é‡‘èˆ‡æµå‹•æ€§ç‡ˆè™Ÿï¼Œå®‰å…¨æ€§ä¸è¶³æ™‚ï¼Œæœ¬å¹´åº¦é‡é»æ”¾åœ¨ã€å¡«è£œé å‚™é‡‘ + é™ä½æ§“æ¡¿ã€ã€‚");
    adviceLines.push("â€¢ ç•¶é å‚™é‡‘å……è¶³ä¸” DSCR â‰¥ 1.2 æ™‚ï¼Œå¯ä»¥æŠŠå¤šé¤˜ç¾é‡‘ç©©å®šæŠ•å…¥æˆé•·è³‡ç”¢ï¼ˆä»¥å¯¬åŸº ETF / é•·æœŸæŒæœ‰æ¨™çš„ç‚ºä¸»ï¼‰ã€‚");
    adviceLines.push("â€¢ è‹¥æˆ¿ç”¢å æ¯”éé«˜ï¼Œä¸”æœªä¾†æœ‰æ›å±‹è¨ˆç•«ï¼Œå¯åˆ©ç”¨é€™å¥—æ¨¡å‹æ¨¡æ“¬ã€Œè³£ä¸€é–“æ›ä¸€é–“ã€çš„æ™‚æ©Ÿèˆ‡é¢¨éšªã€‚");
    adviceLines.push("â€¢ è‹¥å–®ä¸€è‚¡ç¥¨é›†ä¸­åº¦åé«˜ï¼Œå»ºè­°é€æ­¥ç§»è½‰åˆ°åˆ†æ•£åº¦è¼ƒå¥½çš„ ETF æˆ–å¤šæ¨™çš„çµ„åˆï¼Œé™ä½ã€å–®ä¸€å…¬å¸äº‹ä»¶ã€é¢¨éšªã€‚");
    adviceLines.push("â€¢ æ¯ 6ï½12 å€‹æœˆé‡æ–°è¼¸å…¥æœ€æ–°æ•¸å­—ï¼Œæª¢æŸ¥å¥åº·åˆ†æ•¸èˆ‡å…«å¤§å…ƒç´ è®ŠåŒ–ï¼Œç¢ºä¿æ•´é«”æ–¹å‘èˆ‡äººç”Ÿè¨ˆç•«ä¸€è‡´ã€‚");

    document.getElementById("adviceText").innerHTML = adviceLines.join("<br>");

    // ğŸ”¹ é›·é”åœ–ï¼ˆå…«å¤§å…ƒç´ åˆ†æ•¸ï¼‰
    renderRadarChart([s1, s2, s3, s4, s5, s6, s7, s8]);

    // ğŸ”¹ è¤‡åˆ©åœ°åœ–
    // ä½¿ç”¨é¢¨éšªåå¥½æ¨ä¼°å ±é…¬ç‡ï¼š4%ï½8%
    var annualRate = 0.04 + 0.04 * risk;
    // å‡è¨­æ¯å¹´å¯ç©©å®šæŠ•å…¥çš„é‡‘é¡ï¼šè‡ªç”±ç¾é‡‘æµçš„ 70% + æœ¬æ¬¡ allocGrowth æ”¤å¹³åˆ°ç¬¬ä¸€å¹´
    var annualContribution = Math.max(0, freeCash * 12 * 0.7) + allocGrowth;
    renderGrowthChart(netWorth, annualContribution, annualRate, yearsSim);
  });
</script>
</body>
</html>

